<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="blog-uid" content="320616">
    <meta name="blog-name" content="EndCentury">
    <meta name="current-user" content="320616">
    <meta name="theme-settings" content="{&quot;config&quot;:{&quot;background&quot;:{&quot;header&quot;:null},&quot;color&quot;:{&quot;primary&quot;:&quot;indigo&quot;,&quot;accent&quot;:&quot;pink&quot;},&quot;show_icon&quot;:true}}">
    <link rel="stylesheet" href="/static/blog/mdblog/common.css">
    <style>
      .mdblog-background {
        background-image: url();
        max-height: 350px;
      }
    </style>
    <link rel="stylesheet" href="/static/blog/mdblog/article.css">
    <title>P8603 [蓝桥杯 2013 国 C] 横向打印二叉树 - EndCentury - 洛谷博客</title>
</head>
<body class="mdui-theme-primary-indigo
      mdui-theme-accent-pink">
<div class="mdblog-background">
  <nav class="mdui-shadow">
    <div id="small-header"></div>
  </nav>
  <div style="padding-top: 90px;padding-bottom: 40px">
    <img class="mdui-center mdui-img-circle"
         src="https://cdn.luogu.com.cn/upload/usericon/320616.png"
    >
    <div class="mdui-valign">
      <a href="." class="mdui-center mdui-typo-display-2
           mdui-text-color-theme
        "
         style="
         margin-bottom: 0;
         margin-top: 15px;
         text-decoration: none;
      ">
        EndCentury
      </a>

    </div>
    <div class="mdui-valign">
      <p class="mdui-center mdui-typo-subheading-opacity
           mdui-text-color-theme
        "
      >Blog </p>
    </div>
  </div>
</div>

<main class='mdui-container-fluid' style="margin-top: 20px;">
  <section id="main-container" class=" mdui-col-md-8 mdui-col-offset-md-2">
    <div id="blog-container"
         data-blogid="676395"
         data-vote="0"
         data-thumbUp="0">
        <div class="mdblog-article-container mdui-shadow-2 mdui-hoverable">
            <div class="mdui-typo-display-1-opacity">P8603 [蓝桥杯 2013 国 C] 横向打印二叉树</div>
            <br>
            <div style="margin-bottom: 8px;">
                <div class="mdui-typo-caption-opacity  mdblog-article-time mdui-float-left">2023-12-02 12:09:48</div>
                <div id="vote-count"></div>
            </div>
            <br>
            <div class="mdui-typo"><hr/></div>
            <div class="mdui-typo mdblog-article-content" id="article-content">
                <h1>Solution</h1>
<p><strong>Step1:</strong> 读入并建树</p>
<pre><code class="language-cpp">void insert(int x,int t)
{
    if(val[t]==null)
    {
        val[t]=x;
        return;
    }
    if(x&gt;val[t])insert(x,t*2);
    else insert(x,t*2+1);
    return;
}</code></pre>
<p><strong>Step2:</strong> 计算每个节点的行号 $t$</p>
<p>行号其实就是该节点上方有几个节点</p>
<p>设当前节点为 $v$ ，父节点为 $u$</p>
<p>如果这个节点是左儿子，则</p>
<p><img src="https://i.postimg.cc/MGQ0BTFS/image.png" alt="image.png" /></p>
<p>$t_v=t_u-r_v$</p>
<p>如果这个节点是右儿子，则</p>
<p><img src="https://i.postimg.cc/D0kX1kMY/image.png" alt="image.png" /></p>
<p>$t_v=t_u+l_v$</p>
<p>于是可以分成两次计算</p>
<pre><code>第一次:求得每个节点的儿子数（包括自己）和每个节点的左儿子数（倒序）
第二次:根据父亲的行数计算行数（正序）</code></pre>
<pre><code>void calc1(int t)
{
    if(val[t]==null)return;
    all[t]=1;up[t]=1;
    if(val[t*2]!=null)all[t]+=all[t*2],up[t]+=all[t*2];
    if(val[t*2+1]!=null)all[t]+=all[t*2+1];
}
void calc2(int t)
{
    if(val[t/2]!=null)
    {
        if(t%2==1)up[t]=up[t/2]+up[t];
        else up[t]=up[t/2]-(all[t]-up[t]+1);
    }
    if(val[t]==null)return;
}</code></pre>
<p><strong>Step3:</strong> 获得每行的输出值</p>
<p>从根节点开始即可，但是要注意横线的处理。</p>
<p>如果它是连续上升或下降（连续两次是左儿子/右儿子）就不必输出横线</p>
<pre><code>void dfs(int t,string pre,int d1,int d2)
{
    if(val[t]==null)return;
    string str;
    if(t!=1)str+="-";
    str+=to_string(val[t]);
    if(val[t*2]!=null||val[t*2+1]!=null)str+="-|";
    if(d1&gt;=2||d2&gt;=2)
    {
        int bo=0;
        for(int i=pre.size()-1;i&gt;=0;i--)
            if(pre[i]=='|')
            {
                if(bo==1)pre[i]='.';
                bo++;
            }
    }
    line[up[t]]=pre+str;
    if(val[t*2]!=null||val[t*2+1]!=null)
    {
        for(int i=1;i&lt;str.size();i++)pre+='.';
        pre+='|';
    }
    if(val[t*2]!=null)dfs(t*2,pre,0,d2+1);
    if(val[t*2+1]!=null)dfs(t*2+1,pre,d1+1,0);
    return;
}</code></pre>
<h1>Code</h1>
<pre><code>#include&lt;bits/stdc++.h&gt;
using namespace std;
int null=114514;
int val[1010],x;
int up[1010],all[1010];
string line[1010];
void insert(int x,int t)
{
    if(val[t]==null)
    {
        val[t]=x;
        return;
    }
    if(x&gt;val[t])insert(x,t*2);
    else insert(x,t*2+1);
    return;
}
void dfs(int t,string pre,int d1,int d2)
{
    if(val[t]==null)return;
    string str;
    if(t!=1)str+="-";
    str+=to_string(val[t]);
    if(val[t*2]!=null||val[t*2+1]!=null)str+="-|";
    if(d1&gt;=2||d2&gt;=2)
    {
        int bo=0;
        for(int i=pre.size()-1;i&gt;=0;i--)
            if(pre[i]=='|')
            {
                if(bo==1)pre[i]='.';
                bo++;
            }
    }
    line[up[t]]=pre+str;
    if(val[t*2]!=null||val[t*2+1]!=null)
    {
        for(int i=1;i&lt;str.size();i++)pre+='.';
        pre+='|';
    }
    if(val[t*2]!=null)dfs(t*2,pre,0,d2+1);
    if(val[t*2+1]!=null)dfs(t*2+1,pre,d1+1,0);
    return;
}
void calc1(int t)
{
    if(val[t]==null)return;
    all[t]=1;up[t]=1;
    if(val[t*2]!=null)all[t]+=all[t*2],up[t]+=all[t*2];
    if(val[t*2+1]!=null)all[t]+=all[t*2+1];
}
void calc2(int t)
{
    if(val[t/2]!=null)
    {
        if(t%2==1)up[t]=up[t/2]+up[t];
        else up[t]=up[t/2]-(all[t]-up[t]+1);
    }
    if(val[t]==null)return;
}
int main()
{
    for(int i=1;i&lt;=1000;i++)val[i]=null;
    while(cin&gt;&gt;x)insert(x,1);
    for(int i=1000;i&gt;=1;i--)calc1(i);
    for(int i=1;i&lt;=1000;i++)calc2(i);
    dfs(1,"",0,0);
    for(int i=1;line[i]!="";i++)cout&lt;&lt;line[i]&lt;&lt;endl;
}</code></pre>
            </div>
        </div>
    
        <div id="blog-comments"></div>
    
        <div id="vote-buttons"></div>
    
    </div>
    
    <link rel="stylesheet" href="/static/blog/mdblog/katex.css">
  </section>

</main>

<section>
  <div class="mdui-drawer mdui-drawer-close" id="mdblog-drawer">
    <ul class="mdui-list">
      <li onclick="window.location.href='.';"
          class="mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons">star</i>
        <div class="mdui-list-item-content">首页</div>
      </li>
        <li onclick="window.location.href='https://www.luogu.com.cn/blogAdmin';"
            class="mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons">error</i>
          <div class="mdui-list-item-content">管理后台</div>
        </li>
    </ul>
  </div>
</section>
<br>
<footer class="mdui-color-theme">
    <div class="mdui-valign">
      <p class="mdui-center">
        自豪地采用<a href="https://www.luogu.com.cn" style="color: white;">洛谷</a>博客&nbsp;
        Theme mdblog by <a href="https://darkflames.blog.luogu.org/" style="color: white;">darkflames</a>. <a href="_sitemap">Site Map</a>
      </p>
    </div>
</footer>


<script>
window.BlogGlobals = {
  blogName: document.querySelector('meta[name=blog-name]').getAttribute('content'),
  blogUID: parseInt(document.querySelector('meta[name=blog-uid]').getAttribute('content')),
  currentUser: parseInt(document.querySelector('meta[name=current-user]').getAttribute('content')),
  luoguAddress: 'https://www.luogu.com.cn',
  picAddress: 'https://cdn.luogu.com.cn',
  config: JSON.parse(document.querySelector('meta[name=theme-settings]').getAttribute('content'))
}
BlogGlobals.isBlogAdmin = BlogGlobals.blogUID === BlogGlobals.currentUser;
</script>
<script src="/static/blog/mdblog/common.js"></script>
<script>
var blogContainer = document.getElementById('blog-container')
BlogGlobals.blogID = parseInt(blogContainer.getAttribute('data-blogid'))
BlogGlobals.vote = parseInt(blogContainer.getAttribute('data-vote'))
BlogGlobals.thumbUp = parseInt(blogContainer.getAttribute('data-thumbUp'))
</script>
<script src="/static/blog/mdblog/article.js"></script>
</body>
</html>
